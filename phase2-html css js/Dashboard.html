<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Taskify â€“ Dashboard</title>
<style>
/* ---------- shared layout ---------- */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#080f17;color:#fff;height:100vh;display:flex;overflow:hidden}
.sidebar{width:240px;background:#0d1724;border-right:1px solid #1e293b;display:flex;flex-direction:column;transition:left .3s}
.sidebar__brand{padding:1rem 1.5rem;font-weight:700;font-size:1.25rem;border-bottom:1px solid #1e293b}
.sidebar__nav{flex:1;padding:1rem}
.sidebar__link{display:block;padding:.75rem 1rem;border-radius:.375rem;color:#94a3b8;text-decoration:none;margin-bottom:.25rem;transition:background .2s}
.sidebar__link:hover,.sidebar__link--active{background:#1e293b;color:#c1f17e}
.sidebar__logout{background:none;border:none;color:#f87171;padding:1rem;text-align:left;border-top:1px solid #1e293b;cursor:pointer;font:inherit}
.main{flex:1;display:flex;flex-direction:column}
.topbar{display:flex;align-items:center;height:56px;padding:0 1rem;gap:.5rem;background:#080f17;border-bottom:1px solid #1e293b}
.hamburger{width:32px;height:32px;border:1px solid #334155;border-radius:4px;background:none;cursor:pointer;position:relative}
.hamburger span,.hamburger::before,.hamburger::after{content:"";position:absolute;left:6px;right:6px;height:2px;background:#cbd5e1;transition:transform .2s,opacity .2s}
.hamburger::before{top:10px}.hamburger span{top:16px}.hamburger::after{top:22px}
.avatar{margin-left:auto;width:36px;height:36px;border-radius:50%;background:#334155;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.5px;cursor:pointer}
.content{flex:1;overflow-y:auto;padding:2rem}
.content__title{font-size:1.5rem;font-weight:600;margin-bottom:2rem}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:2rem}
.card{background:#0d1724;border:1px solid #1e293b;border-radius:.5rem;padding:1.5rem}
.card__label{color:#94a3b8;font-size:1rem;margin-bottom:.5rem}.card__value{font-size:2rem;font-weight:700}
.table{width:100%;border-collapse:collapse;background:#0d1724;border:1px solid #1e293b}
.table th,.table td{padding:.75rem 1rem;text-align:left;border-bottom:1px solid #1e293b}
.table th{background:#0f1c2e;color:#94a3b8;font-size:.875rem;font-weight:500;text-transform:uppercase}
.table tbody tr:hover{background:#1e293b}
.btn{padding:.25rem .75rem;border:1px solid #334155;border-radius:.375rem;background:none;color:#c1f17e;font-size:.875rem;cursor:pointer}
.btn:hover{background:#1e293b}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:10}
.modal.is-open{display:flex}
.modal__box{background:#0d1724;padding:2rem;border-radius:.5rem;width:90%;max-width:420px}
.modal__header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
.modal__close{background:none;border:0;color:#f87171;font-size:1.25rem;cursor:pointer}
.modal label{font-size:.875rem;color:#94a3b8;display:block;margin-bottom:.25rem}
.modal input{width:100%;padding:.5rem;border:1px solid #334155;border-radius:.375rem;background:#0f1c2e;color:#e2e8f0;margin-bottom:1rem}
/* mobile */
@media(max-width:768px){body{flex-direction:column}.sidebar{position:fixed;left:-240px;top:0;bottom:0}body.menu-open .sidebar{left:0}.hamburger.x::before{transform:translateY(6px) rotate(45deg)}.hamburger.x::after{transform:translateY(-6px) rotate(-45deg)}.hamburger.x span{opacity:0}}
</style>
</head>
<body>
<!-- sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar__brand">Taskify</div>
  <nav class="sidebar__nav">
    <a class="sidebar__link sidebar__link--active" href="dashboard.html">Dashboard</a>
    <a class="sidebar__link" href="tasks.html">Tasks</a>
  </nav>
  <button class="sidebar__logout" id="btnLogout">Log out</button>
</aside>

<!-- main -->
<div class="main">
  <header class="topbar">
    <button class="hamburger" id="hamburger" aria-label="Toggle sidebar"><span></span></button>
    <div class="avatar" id="avatar">--</div>
  </header>

  <section class="content">
    <h1 class="content__title" id="welcome">Welcome</h1>
    <div class="cards">
      <div class="card"><div class="card__label">To-Do</div><div class="card__value" id="todoCount">0</div></div>
      <div class="card"><div class="card__label">Completed</div><div class="card__value" id="completedCount">0</div></div>
    </div>
    <table class="table" id="tasksTable">
      <thead>
        <tr>
          <th>Task</th>
          <th>Status</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</div>

<!-- view modal -->
<div class="modal" id="viewModal">
  <div class="modal__box">
    <div class="modal__header">
      <h3>Task details</h3>
      <button class="modal__close" data-close>&times;</button>
    </div>
    <p id="viewBody"></p>
  </div>
</div>

<!-- profile modal -->
<div class="modal" id="profileModal">
  <div class="modal__box">
    <div class="modal__header">
      <h3>Edit Profile</h3>
      <button class="modal__close" data-close>&times;</button>
    </div>
    <form id="profileForm">
      <label for="pUsername">Username</label>
      <input id="pUsername" required minlength="2" />
      <label for="pPassword">Password</label>
      <input id="pPassword" type="password" required minlength="6" />
      <button class="btn" style="width:100%;margin-top:.5rem" type="submit">Save</button>
    </form>
  </div>
</div>

<script>
/* helpers */
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);
const open = (m) => $(m).classList.add("is-open");
const close = (el) => el.closest(".modal").classList.remove("is-open");
$$("[data-close]").forEach((b) => (b.onclick = (e) => close(e.target)));
window.addEventListener("keydown", (e) => e.key === "Escape" && $$(".modal.is-open").forEach((m) => m.classList.remove("is-open")));

/* auth */
const token = localStorage.getItem("token"),
  userStr = localStorage.getItem("user");
if (!token || !userStr) {
  location.href = "login.html";
  throw "";
}
let user = JSON.parse(userStr);
$("#avatar").textContent =
  (user.firstName?.[0] + user.lastName?.[0] || user.username.slice(0, 2)).toUpperCase();
$("#welcome").textContent = `Welcome to Taskify, ${user.firstName || user.username}`;

/* fetch tasks */
let tasks = [];
(async () => {
  const r = await fetch("https://dummyjson.com/todos?limit=10");
  const js = await r.json();
  tasks = js.todos.map((t) => ({
    id: t.id,
    name: t.todo,
    status: t.completed ? "Completed" : "To-Do",
    date: `2023-10-${String(t.id).padStart(2, "0")}`,
  }));
  render();
})();
function render() {
  $("#todoCount").textContent = tasks.filter((t) => t.status === "To-Do").length;
  $("#completedCount").textContent = tasks.filter((t) => t.status === "Completed").length;
  const tb = $("#tasksTable tbody");
  tb.innerHTML = "";
  tasks.forEach((t) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.name}</td>
      <td>${t.status}</td>
      <td>${t.date}</td>
      <td><button class="btn" data-view="${t.id}">View</button></td>
    `;
    tb.appendChild(tr);
  });
}

/* view button */
$("#tasksTable").onclick = (e) => {
  if (e.target.dataset.view) {
    const t = tasks.find((x) => x.id == e.target.dataset.view);
    $("#viewBody").innerHTML = `<strong>${t.name}</strong><br>Status: ${t.status}<br>Date: ${t.date}`;
    open("#viewModal");
  }
};

/* profile */
$("#avatar").onclick = () => {
  $("#pUsername").value = user.username || "";
  $("#pPassword").value = user.password || "";
  open("#profileModal");
};
$("#profileForm").onsubmit = (e) => {
  e.preventDefault();
  user.username = $("#pUsername").value.trim();
  user.password = $("#pPassword").value;
  localStorage.setItem("user", JSON.stringify(user));
  $("#avatar").textContent = user.username.slice(0, 2).toUpperCase();
  close(e.target);
};

/* nav / logout / mobile */
$("#btnLogout").onclick = () => {
  localStorage.clear();
  location.href = "login.html";
};
$("#hamburger").onclick = (e) => {
  document.body.classList.toggle("menu-open");
  e.currentTarget.classList.toggle("x");
};
</script>
</body>
</html>
